<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>日益智慧能源 - 2025年度維運服務滿意度調查</title>
    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX Compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body { 
            font-family: 'Noto Sans TC', sans-serif; 
            -webkit-font-smoothing: antialiased;
            scroll-behavior: smooth;
        }
        .bg-solar {
            background-image: linear-gradient(to bottom, rgba(14, 165, 233, 0.5), rgba(248, 250, 252, 1)), 
                              url('https://images.unsplash.com/photo-1509391366360-2e959784a276?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        @keyframes progress-run {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        .animate-progress {
            animation: progress-run 3s linear forwards;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // 全域常數設定
        const SCORE_OPTIONS = ["1.非常不滿意", "2.不滿意", "3.尚可", "4.滿意", "5.非常滿意"];
        const GOOGLE_FORM_META = {
            action: "https://docs.google.com/forms/u/0/d/e/1FAIpQLScWKCVehF5x0dh4jXpC6pitzsvmOJSzUrGvWHh3hfuW332JNQ/formResponse",
            fbzx: "764606553543506960",
            pageHistory: "0",
            fvv: "1"
        };

        // 圖示組件
        const IconFactory = () => (
            <svg className="w-6 h-6 text-sky-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path d="M2 20a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8l-7 5V8l-7 5V4a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2Z"/></svg>
        );
        const IconUser = () => (
            <svg className="w-6 h-6 text-sky-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        );

        const App = () => {
            const [formData, setFormData] = useState({
                'entry.899999615': '', // 案場名稱
                'entry.464377799': [], // 填寫人
                'entry.1414352831': '', // 1.滿意度
                'entry.726589747': [], // 1-1 原因
                'entry.418035188': '', // 2.符合度
                'entry.842552003': [], // 2-1 原因
                'entry.2061844101': '', // 3.競爭力
                'entry.67805626': [], // 3-1 原因
                'entry.1003343879': '', // 4.巡檢
                'entry.1664860146': '', // 5.問題發現
                'entry.1578497332': '', // 6.回應速度
                'entry.553624540': '', // 7.故障排除
                'entry.1437601907': '', // 8.監控通知
                'entry.1343935114': '', // 9.報告理解
                'entry.2141434383': '', // 10.溝通
                'entry.2082616046': '', // 11.需求理解
                'entry.951165679': [], // 12.改善項目
                'entry.1748333818': '', // 13.改善空間
                'entry.1579464985': '', // 14.優化
                'entry.1045920345': ''  // 15.其他
            });

            const [status, setStatus] = useState('idle'); 

            const handleCheckboxChange = (name, value) => {
                setFormData(prev => {
                    const current = prev[name];
                    return current.includes(value) 
                        ? { ...prev, [name]: current.filter(item => item !== value) }
                        : { ...prev, [name]: [...current, value] };
                });
            };

            const onFormSubmit = () => {
                setStatus('submitting');
                // 延遲 3 秒，確保背景 Iframe 順利完成 Post 動作
                setTimeout(() => {
                    setStatus('submitted');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }, 3000);
            };

            const renderRadioOptions = (name, label, options) => (
                <div className="mb-6 p-6 bg-white/90 rounded-2xl shadow-sm border border-sky-100">
                    <label className="block text-slate-800 font-bold mb-5 text-lg">
                        {label} <span className="text-rose-500">*</span>
                    </label>
                    <div className="grid grid-cols-1 md:grid-cols-5 gap-2">
                        {options.map((opt) => (
                            <button
                                key={opt} type="button"
                                onClick={() => setFormData(prev => ({ ...prev, [name]: opt }))}
                                className={`px-2 py-3 rounded-xl border-2 text-center transition-all text-sm font-bold ${
                                    formData[name] === opt 
                                        ? 'border-sky-500 bg-sky-500 text-white shadow-md' 
                                        : 'border-slate-100 bg-white text-slate-500 hover:border-sky-200'
                                }`}
                            >
                                {opt}
                            </button>
                        ))}
                    </div>
                    <input type="hidden" name={name} value={formData[name]} required />
                </div>
            );

            const renderCheckboxOptions = (name, label, options) => (
                <div className="mb-6 p-6 bg-white/90 rounded-2xl shadow-sm border border-sky-100">
                    <label className="block text-slate-800 font-bold mb-5 text-lg">{label}</label>
                    <div className="flex flex-wrap gap-2">
                        {options.map((opt) => (
                            <button
                                key={opt} type="button"
                                onClick={() => handleCheckboxChange(name, opt)}
                                className={`px-5 py-2 rounded-full border-2 transition-all text-sm font-bold ${
                                    formData[name].includes(opt)
                                        ? 'border-amber-500 bg-amber-500 text-white'
                                        : 'border-slate-100 bg-white text-slate-500'
                                }`}
                            >
                                {opt}
                            </button>
                        ))}
                    </div>
                    {formData[name].map((val, idx) => <input key={`${name}-${idx}`} type="hidden" name={name} value={val} />)}
                </div>
            );

            return (
                <div className="min-h-screen bg-slate-50 overflow-x-hidden">
                    {/* 成功覆蓋層 */}
                    {status === 'submitted' && (
                        <div className="fixed inset-0 z-[100] bg-white flex items-center justify-center p-6">
                            <div className="text-center max-w-md w-full">
                                <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                    <svg className="w-10 h-10 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" strokeWidth="4"><path strokeLinecap="round" strokeLinejoin="round" d="M5 13l4 4L19 7"/></svg>
                                </div>
                                <h2 className="text-3xl font-black text-slate-800 mb-4">提交成功！</h2>
                                <p className="text-slate-500 text-lg mb-8 leading-relaxed">感謝您撥冗填寫。<br/>您的寶貴回饋已順利傳送至日益智慧能源系統。</p>
                                <button onClick={() => window.location.reload()} className="w-full bg-sky-500 text-white py-4 rounded-2xl font-bold text-lg shadow-lg shadow-sky-100">重新填寫</button>
                            </div>
                        </div>
                    )}

                    {/* 表單主體 */}
                    <div className={status === 'submitted' ? 'hidden' : ''}>
                        <header className="relative h-[300px] flex items-center justify-center bg-solar">
                            <div className="absolute inset-0 bg-black/10"></div>
                            <div className="relative z-10 text-center px-4">
                                <h1 className="text-white text-4xl md:text-6xl font-black mb-4 drop-shadow-lg tracking-widest">日益智慧能源</h1>
                                <p className="text-white text-lg font-bold bg-sky-500/90 px-6 py-1.5 rounded-full inline-block backdrop-blur-sm">2025年度維運服務滿意度調查</p>
                            </div>
                        </header>

                        <main className="max-w-4xl mx-auto -mt-8 relative z-10 px-4">
                            <div className="bg-white p-6 md:p-10 rounded-3xl shadow-xl mb-8 border border-sky-50">
                                <p className="text-slate-600 text-lg leading-relaxed text-center">
                                    本問卷旨在了解貴公司對本案場維運服務之感受，回饋將作為我們優化品質之重要依據。
                                </p>
                            </div>

                            <iframe name="hidden_frame" id="hidden_frame" style={{display: 'none'}}></iframe>

                            <form action={GOOGLE_FORM_META.action} method="POST" target="hidden_frame" onSubmit={onFormSubmit}>
                                <input type="hidden" name="fbzx" value={GOOGLE_FORM_META.fbzx} />
                                <input type="hidden" name="pageHistory" value={GOOGLE_FORM_META.pageHistory} />
                                <input type="hidden" name="fvv" value={GOOGLE_FORM_META.fvv} />

                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                    <div className="p-6 bg-white rounded-2xl shadow-sm border border-sky-50">
                                        <div className="flex items-center gap-2 mb-4"><IconFactory /><label className="font-bold text-slate-700">案場名稱 *</label></div>
                                        <input required type="text" name="entry.899999615" placeholder="填寫完整案場名稱" className="w-full p-4 rounded-xl bg-slate-50 border-2 border-transparent focus:border-sky-500 focus:bg-white outline-none font-bold transition-all" />
                                    </div>
                                    <div className="p-6 bg-white rounded-2xl shadow-sm border border-sky-50">
                                        <div className="flex items-center gap-2 mb-4"><IconUser /><label className="font-bold text-slate-700">填寫人身份 *</label></div>
                                        <div className="flex flex-wrap gap-2">
                                            {["公司負責人", "維運承辦人", "專案負責人"].map(role => (
                                                <button key={role} type="button" onClick={() => handleCheckboxChange('entry.464377799', role)}
                                                    className={`px-4 py-2 rounded-lg border-2 text-sm font-bold transition-all ${formData['entry.464377799'].includes(role) ? 'bg-sky-500 border-sky-500 text-white shadow-sm' : 'bg-white border-slate-100 text-slate-400'}`}>
                                                    {role}
                                                </button>
                                            ))}
                                        </div>
                                        {formData['entry.464377799'].map((val, idx) => <input key={`role-${idx}`} type="hidden" name="entry.464377799" value={val} />)}
                                    </div>
                                </div>

                                <div className="space-y-4">
                                    <h3 className="text-xl font-black text-slate-800 pt-6 pb-2 pl-2 flex items-center gap-2">
                                        <span className="w-1.5 h-6 bg-sky-500 rounded-full"></span> 服務滿意度評分
                                    </h3>
                                    
                                    {renderRadioOptions('entry.1414352831', '1. 整體而言，您對本案場目前的維運服務滿意程度為何？', SCORE_OPTIONS)}
                                    
                                    {(formData['entry.1414352831'] && !formData['entry.1414352831'].includes('4') && !formData['entry.1414352831'].includes('5')) && 
                                        renderCheckboxOptions('entry.726589747', '1-1. 請簡要說明較不符合期待的主要原因：', ["回應速度偏慢", "問題處理不夠即時", "技術說明或溝通不夠清楚", "巡檢或保養品質待加強", "故障排除效率不足", "與內部需求配合度不足"])}

                                    {renderRadioOptions('entry.418035188', '2. 較您的期待，本公司的維運服務表現符合程度為何？', SCORE_OPTIONS)}
                                    
                                    {(formData['entry.418035188'] && !formData['entry.418035188'].includes('4') && !formData['entry.418035188'].includes('5')) && 
                                        renderCheckboxOptions('entry.842552003', '2-1. 您認為與原先期待落差較大的部分為何：', ["回應速度", "技術專業度", "服務內容深度", "溝通與說明方式", "整體資源投入"])}

                                    {renderRadioOptions('entry.2061844101', '3. 若以同類型服務比較，您認為本公司的維運品質競爭力為何？', ["1.非常沒有競爭力", "2.沒有競爭力", "3.尚可", "4.有競爭力", "5.非常有競爭力"])}
                                    
                                    {(formData['entry.2061844101'] && !formData['entry.2061844101'].includes('4') && !formData['entry.2061844101'].includes('5')) && 
                                        renderCheckboxOptions('entry.67805626', '3-1. 與其他服務商相比，您認為本公司較需要加強的面向：', ["價值感受與費用對應", "回應效率", "技術能力", "主動性與改善建議", "溝通協調"])}

                                    <h3 className="text-xl font-black text-slate-800 pt-8 pb-2 pl-2 flex items-center gap-2">
                                        <span className="w-1.5 h-6 bg-amber-500 rounded-full"></span> 維運品質細項
                                    </h3>
                                    {renderRadioOptions('entry.1003343879', '4. 定期巡檢與保養執行的確實程度', SCORE_OPTIONS)}
                                    {renderRadioOptions('entry.1664860146', '5. 問題發現與回報的即時性', SCORE_OPTIONS)}
                                    {renderRadioOptions('entry.1578497332', '6. 異常事件的回應速度', SCORE_OPTIONS)}
                                    {renderRadioOptions('entry.553624540', '7. 故障排除的專業度與完整性', SCORE_OPTIONS)}
                                    {renderRadioOptions('entry.1437601907', '8. 發電監控與異常通知的清楚程度', SCORE_OPTIONS)}
                                    {renderRadioOptions('entry.1343935114', '9. 維運相關報告或說明的理解性', SCORE_OPTIONS)}
                                    {renderRadioOptions('entry.2141434383', '10. 維運窗口的溝通順暢度', SCORE_OPTIONS)}
                                    {renderRadioOptions('entry.2082616046', '11. 對客戶需求與現場狀況的理解程度', SCORE_OPTIONS)}
                                    {renderCheckboxOptions('entry.951165679', '12. 您認為目前最需要優先改善的項目為：', ["1.回應速度", "2.技術說明", "3.巡檢品質", "4.溝通方式"])}
                                    {renderRadioOptions('entry.1748333818', '13. 整體而言，您認為目前維運服務是否仍有明顯改善空間？', ["1.幾乎沒有", "2.少量", "3.中等", "4.明顯"])}

                                    <div className="p-6 bg-white rounded-3xl border-2 border-slate-100 focus-within:border-sky-500 shadow-sm transition-all mt-10">
                                        <label className="block text-slate-800 font-bold mb-4">14. 若未來可調整部分服務內容，您最希望優化的是？ *</label>
                                        <textarea required name="entry.1579464985" rows="4" className="w-full p-4 bg-slate-50 rounded-xl outline-none font-medium text-slate-700 focus:bg-white"></textarea>
                                    </div>
                                    <div className="p-6 bg-white rounded-3xl border-2 border-slate-100 focus-within:border-amber-500 shadow-sm transition-all">
                                        <label className="block text-slate-800 font-bold mb-4">15. 其他您願意提供的建議或回饋 *</label>
                                        <textarea required name="entry.1045920345" rows="4" className="w-full p-4 bg-slate-50 rounded-xl outline-none font-medium text-slate-700 focus:bg-white"></textarea>
                                    </div>
                                </div>

                                <div className="py-20 text-center">
                                    <button type="submit" className={`relative overflow-hidden w-full max-w-2xl bg-slate-900 text-white py-6 rounded-2xl font-black text-2xl shadow-2xl hover:scale-[1.01] active:scale-95 transition-all flex items-center justify-center gap-4 mx-auto ${status === 'submitting' ? 'opacity-80' : ''}`}>
                                        {status === 'submitting' ? (
                                            <>
                                                <div className="absolute bottom-0 left-0 h-1.5 bg-sky-500 animate-progress"></div>
                                                <span className="animate-pulse">傳送中...</span>
                                            </>
                                        ) : (
                                            <>確認並提交問卷</>
                                        )}
                                    </button>
                                    <p className="text-slate-400 font-bold mt-8 tracking-widest text-xs uppercase">日益智慧能源股份有限公司 © 2025 ALL RIGHTS RESERVED</p>
                                </div>
                            </form>
                        </main>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>